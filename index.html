<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90症状自评量表</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- Tailwind 配置 -->
    <script>
        // ========== 兑换码系统功能 ==========

        // 生成8位随机兑换码
        function generateRedeemCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除容易混淆的字符
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // 生成带前缀的兑换码
        function generatePrefixedRedeemCode(prefix = 'SCL') {
            return prefix + '-' + generateRedeemCode();
        }

        // 获取设备唯一标识
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            
            return deviceId;
        }

        // 获取设备信息
        function getDeviceInfo() {
            return {
                deviceId: getDeviceId(),
                userAgent: navigator.userAgent,
                screen: `${window.screen.width}x${window.screen.height}`,
                language: navigator.language,
                platform: navigator.platform
            };
        }

        // 验证兑换码
        function validateRedeemCode(code) {
            try {
                const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
                const redeemCode = redeemCodes.find(rc => rc.code === code);
                
                if (!redeemCode) {
                    return { valid: false, message: '兑换码不存在' };
                }
                
                if (redeemCode.status !== 'active' && redeemCode.status !== 'used') {
                    return { valid: false, message: '兑换码已失效' };
                }
                
                const now = Date.now();
                if (now > redeemCode.expiresAt) {
                    redeemCode.status = 'expired';
                    localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                    return { valid: false, message: '兑换码已过期' };
                }
                
                const deviceId = getDeviceId();
                
                if (redeemCode.status === 'used') {
                    if (redeemCode.deviceInfo.deviceId !== deviceId) {
                        return { valid: false, message: '兑换码已被其他设备使用' };
                    }
                } else {
                    redeemCode.status = 'used';
                    redeemCode.deviceInfo = getDeviceInfo();
                    redeemCode.usedAt = now;
                    // 使用后才开始计算有效期
                    const expiryDays = redeemCode.expiryDays || 1; // 默认1天
                    redeemCode.expiresAt = now + (expiryDays * 24 * 60 * 60 * 1000);
                    localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                }
                
                redeemCode.lastAccessed = now;
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                
                localStorage.setItem('currentRedeemCode', JSON.stringify({
                    code: redeemCode.code,
                    expiresAt: redeemCode.expiresAt,
                    deviceId: deviceId
                }));
                
                return { 
                    valid: true, 
                    message: '兑换码验证成功',
                    expiresAt: redeemCode.expiresAt,
                    remainingTime: redeemCode.expiresAt - now
                };
                
            } catch (error) {
                console.error('验证兑换码时出错:', error);
                return { valid: false, message: '验证兑换码时发生错误' };
            }
        }

        // 检查用户是否有权限访问功能
        function checkAccessPermission() {
            try {
                const currentCode = localStorage.getItem('currentRedeemCode');
                
                if (!currentCode) {
                    return { hasPermission: false, reason: '未登录' };
                }
                
                const codeData = JSON.parse(currentCode);
                const now = Date.now();
                
                if (now > codeData.expiresAt) {
                    return { hasPermission: false, reason: '兑换码已过期' };
                }
                
                const deviceId = getDeviceId();
                if (codeData.deviceId !== deviceId) {
                    return { hasPermission: false, reason: '设备不匹配' };
                }
                
                return { hasPermission: true };
                
            } catch (error) {
                console.error('检查权限时出错:', error);
                return { hasPermission: false, reason: '验证失败' };
            }
        }

        // 保护页面访问
        function protectPageAccess() {
            const permission = checkAccessPermission();
            
            if (!permission.hasPermission) {
                showSection('login');
                return false;
            }
            
            return true;
        }

        // 创建新的兑换码
        function createNewRedeemCode() {
            const code = generatePrefixedRedeemCode();
            const now = Date.now();
            const expiresAt = now + (10 * 365 * 24 * 60 * 60 * 1000); // 未使用时有效期10年（相当于永久）
            
            const newCode = {
                code: code,
                createdAt: now,
                expiresAt: expiresAt,
                status: 'active',
                deviceInfo: null,
                usedAt: null,
                lastAccessed: null
            };
            
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            redeemCodes.push(newCode);
            localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            
            return newCode;
        }

        // 获取所有兑换码
        function getAllRedeemCodes() {
            return JSON.parse(localStorage.getItem('redeemCodes') || '[]');
        }

        // 更新兑换码状态
        function updateRedeemCodeStatus(code, status) {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const codeIndex = redeemCodes.findIndex(rc => rc.code === code);
            
            if (codeIndex !== -1) {
                redeemCodes[codeIndex].status = status;
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                return true;
            }
            
            return false;
        }

        // 删除兑换码
        function deleteRedeemCode(code) {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const filteredCodes = redeemCodes.filter(rc => rc.code !== code);
            
            localStorage.setItem('redeemCodes', JSON.stringify(filteredCodes));
            return true;
        }

        // 清理过期的兑换码
        function cleanupExpiredCodes() {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const now = Date.now();
            let updated = false;
            
            redeemCodes.forEach(code => {
                if (code.status === 'active' && now > code.expiresAt) {
                    code.status = 'expired';
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            }
        }

        // 初始化管理员账户
        function initializeAdminAccount() {
            const adminAccount = localStorage.getItem('adminAccount');
            
            if (!adminAccount) {
                const defaultAdmin = {
                    username: 'admin',
                    password: 'admin123',
                    createdAt: Date.now()
                };
                
                localStorage.setItem('adminAccount', JSON.stringify(defaultAdmin));
            }
        }

        // 管理员登录验证
        function authenticateAdmin(username, password) {
            const adminAccount = JSON.parse(localStorage.getItem('adminAccount') || '{}');
            
            return adminAccount.username === username && adminAccount.password === password;
        }

        // 格式化时间戳
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // 获取状态显示文本和样式
        function getStatusDisplay(status) {
            switch (status) {
                case 'active':
                    return { text: '未使用', class: 'bg-green-100 text-green-800' };
                case 'used':
                    return { text: '已使用', class: 'bg-blue-100 text-blue-800' };
                case 'expired':
                    return { text: '已过期', class: 'bg-gray-100 text-gray-800' };
                case 'invalid':
                    return { text: '已禁用', class: 'bg-red-100 text-red-800' };
                default:
                    return { text: '未知', class: 'bg-yellow-100 text-yellow-800' };
            }
        }

        // 渲染兑换码列表
        function renderRedeemCodes() {
            const codes = getAllRedeemCodes();
            const tableBody = document.getElementById('codes-table-body');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            codes.forEach(code => {
                const status = getStatusDisplay(code.status);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td class="py-4 px-4 border-b border-gray-200">${code.code}</td>
                    <td class="py-4 px-4 border-b border-gray-200">${formatTimestamp(code.createdAt)}</td>
                    <td class="py-4 px-4 border-b border-gray-200">${formatTimestamp(code.expiresAt)}</td>
                    <td class="py-4 px-4 border-b border-gray-200">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${status.class}">${status.text}</span>
                    </td>
                    <td class="py-4 px-4 border-b border-gray-200">${code.deviceInfo ? code.deviceInfo.deviceId.substring(0, 10) + '...' : '-'}</td>
                    <td class="py-4 px-4 border-b border-gray-200">
                        <div class="flex space-x-2">
                            ${code.status === 'active' ? `
                                <button class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors" 
                                        onclick="updateRedeemCodeStatus('${code.code}', 'invalid'); renderRedeemCodes();">
                                    禁用
                                </button>
                            ` : ''}
                            ${code.status === 'invalid' ? `
                                <button class="px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600 transition-colors" 
                                        onclick="updateRedeemCodeStatus('${code.code}', 'active'); renderRedeemCodes();">
                                    启用
                                </button>
                            ` : ''}
                            <button class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors" 
                                    onclick="if(confirm('确定要删除这个兑换码吗？')) { deleteRedeemCode('${code.code}'); renderRedeemCodes(); }">
                                删除
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // 显示登录错误信息
        function showLoginError(message) {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }
        }

        // 隐藏登录错误信息
        function hideLoginError() {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.classList.add('hidden');
            }
        }

        // 初始化兑换码系统事件监听
        function initializeRedeemCodeEventListeners() {
            // 登录按钮
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                    const redeemCodeInput = document.getElementById('redeem-code');
                    const code = redeemCodeInput ? redeemCodeInput.value.trim().toUpperCase() : '';
                    
                    if (!code) {
                        showLoginError('请输入兑换码');
                        return;
                    }
                    
                    hideLoginError();
                    
                    const result = validateRedeemCode(code);
                    
                    if (result.valid) {
                        showSection('home');
                        showNotification(`登录成功！兑换码有效期至：${new Date(result.expiresAt).toLocaleString('zh-CN')}`, 'success');
                    } else {
                        showLoginError(result.message);
                    }
                });
            }
            
            // 单个生成兑换码按钮
            const generateCodeBtn = document.getElementById('generate-code-btn');
            if (generateCodeBtn) {
                generateCodeBtn.addEventListener('click', function() {
                    const newCode = createNewRedeemCode();
                    renderRedeemCodes();
                    showNotification(`新兑换码已生成：${newCode.code}`, 'success');
                });
            }
            
            // 批量生成兑换码按钮
            const generateBatchBtn = document.getElementById('generate-batch-btn');
            if (generateBatchBtn) {
                generateBatchBtn.addEventListener('click', function() {
                    const count = parseInt(document.getElementById('batch-count').value) || 10;
                    const expiryDays = parseInt(document.getElementById('expiry-days').value) || 1;
                    const prefix = document.getElementById('code-prefix').value || 'SCL';
                    
                    if (count < 1 || count > 1000) {
                        showNotification('生成数量必须在1-1000之间', 'error');
                        return;
                    }
                    
                    const newCodes = generateBatchCodes(count, expiryDays, prefix);
                    renderRedeemCodes();
                    showNotification(`成功生成 ${count} 个兑换码`, 'success');
                });
            }
            
            // 导出CSV按钮
            const exportCsvBtn = document.getElementById('export-csv-btn');
            if (exportCsvBtn) {
                exportCsvBtn.addEventListener('click', function() {
                    exportToCSV();
                });
            }
            
            // 清空兑换码按钮
            const clearCodesBtn = document.getElementById('clear-codes-btn');
            if (clearCodesBtn) {
                clearCodesBtn.addEventListener('click', function() {
                    if (confirm('确定要清空所有兑换码吗？此操作不可恢复！')) {
                        clearAllCodes();
                        renderRedeemCodes();
                        showNotification('已清空所有兑换码', 'success');
                    }
                });
            }
            
            // 搜索兑换码
            const searchCodesInput = document.getElementById('search-codes');
            if (searchCodesInput) {
                searchCodesInput.addEventListener('input', function() {
                    renderRedeemCodes();
                });
            }
            
            // 兑换码输入框回车事件
            const redeemCodeInput = document.getElementById('redeem-code');
            if (redeemCodeInput) {
                redeemCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const loginBtn = document.getElementById('login-btn');
                        if (loginBtn) {
                            loginBtn.click();
                        }
                    }
                });
            }
        }
        
        // 批量生成兑换码
        function generateBatchCodes(count, expiryDays, prefix) {
            const newCodes = [];
            const now = Date.now();
            const expiryMs = expiryDays * 24 * 60 * 60 * 1000;
            
            for (let i = 0; i < count; i++) {
                const code = generatePrefixedRedeemCode(prefix);
                newCodes.push({
                    code: code,
                    createdAt: now,
                    expiresAt: now + (10 * 365 * 24 * 60 * 60 * 1000), // 未使用时有效期10年（相当于永久）
                    expiryDays: expiryDays, // 记录使用后有效期天数
                    status: 'active',
                    deviceInfo: null,
                    usedAt: null,
                    lastAccessed: null
                });
            }
            
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            redeemCodes.push(...newCodes);
            localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            
            return newCodes;
        }
        
        // 导出为CSV
        function exportToCSV() {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const activeCodes = redeemCodes.filter(code => code.status === 'active');
            
            if (activeCodes.length === 0) {
                showNotification('没有可用的兑换码', 'warning');
                return;
            }
            
            // 创建CSV内容
            let csvContent = "兑换码,创建时间,过期时间\n";
            
            activeCodes.forEach(code => {
                const createdAt = new Date(code.createdAt).toLocaleString('zh-CN');
                const expiresAt = new Date(code.expiresAt).toLocaleString('zh-CN');
                csvContent += `"${code.code}","${createdAt}","${expiresAt}"\n`;
            });
            
            // 创建Blob对象
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `兑换码_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            // 添加到页面并触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`成功导出 ${activeCodes.length} 个兑换码`, 'success');
        }
        
        // 清空所有兑换码
        function clearAllCodes() {
            localStorage.removeItem('batchRedeemCodes');
        }
        
        // 生成单个兑换码（增强版）
        function createNewRedeemCode() {
            const prefix = document.getElementById('code-prefix') ? document.getElementById('code-prefix').value : 'SCL';
            const expiryDays = document.getElementById('expiry-days') ? parseInt(document.getElementById('expiry-days').value) : 1;
            
            const code = generateRedeemCode(prefix);
            const now = Date.now();
            const expiryMs = expiryDays * 24 * 60 * 60 * 1000;
            
            const newCode = {
                code: code,
                createdAt: now,
                expiresAt: now + expiryMs,
                status: 'active'
            };
            
            const redeemCodes = JSON.parse(localStorage.getItem('batchRedeemCodes') || '[]');
            redeemCodes.unshift(newCode);
            localStorage.setItem('batchRedeemCodes', JSON.stringify(redeemCodes));
            
            return newCode;
        }
        
        // 生成兑换码字符串
        function generateRedeemCode(prefix = 'SCL') {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除容易混淆的字符
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return prefix + '-' + code;
        }
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#60a5fa',
                        accent: '#2563eb',
                        light: '#dbeafe',
                        dark: '#1e3a8a'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.5s ease-in-out',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .bg-gradient {
                background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1), 0 4px 6px -2px rgba(59, 130, 246, 0.05);
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
        }
    </style>
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #f8fafc;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .option-hover:hover {
            transform: translateY(-2px);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-in {
            animation: slideIn 0.5s ease-in-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .bg-wave {
            background-image: url('https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/de55907c21df4668933070aaac9af164~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=20260122120540A0A3845125721304BA05&rrcfp=f06b921b&x-expires=1771646791&x-signature=fRVqNCCawx5N9jgKAISiZ80J4pg%3D');
            background-size: cover;
            background-position: center;
        }
        .overlay {
            background-color: rgba(255, 255, 255, 0.9);
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="bg-white shadow-md fixed w-full z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8e0588acf21c4fd6ae368b01ef4f018f~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=20260122120540A0A3845125721304BA05&rrcfp=f06b921b&x-expires=1771646782&x-signature=v19Yaxu%2FPUgWbIM0438P%2F5Pk%2BMs%3D" alt="Logo" class="h-10 w-10">
                <span class="text-xl font-bold text-primary">心理健康评估</span>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-home">首页</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-about">关于量表</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-test">开始测试</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-result">查看结果</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-login">登录</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300" id="nav-admin">管理员</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-700 hover:text-primary focus:outline-none">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg absolute w-full">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-home">首页</a>
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-about">关于量表</a>
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-test">开始测试</a>
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-result">查看结果</a>
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-login">登录</a>
                <a href="#" class="text-gray-700 hover:text-primary py-2 transition-all-300" id="mobile-nav-admin">管理员</a>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="pt-16">
        <!-- 首页 -->
        <section id="home" class="min-h-screen bg-wave">
            <div class="overlay min-h-screen flex items-center">
                <div class="container mx-auto px-4 py-16">
                    <div class="max-w-3xl mx-auto text-center slide-in">
                        <h1 class="text-4xl md:text-5xl font-bold text-primary mb-6 text-shadow">SCL-90症状自评量表</h1>
                        <p class="text-xl text-gray-700 mb-8">全面评估您的心理健康状况，了解内心世界的真实状态</p>
                        <div class="flex flex-col md:flex-row justify-center gap-4">
                            <button id="start-test-btn" class="bg-primary hover:bg-accent text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all-300 text-lg">
                                开始测试
                            </button>
                            <button id="learn-more-btn" class="bg-white hover:bg-light text-primary font-bold py-3 px-8 rounded-lg shadow-lg transition-all-300 text-lg border border-primary">
                                了解更多
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 关于量表 -->
        <section id="about" class="py-16 bg-white hidden">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-primary mb-8 text-center">关于SCL-90症状自评量表</h2>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">量表简介</h3>
                        <p class="text-gray-700 mb-4">
                            SCL-90（Symptom Checklist 90）症状自评量表是由Derogatis于1975年编制的综合性心理健康评估工具，旨在全面评估个体近期（通常为1周内）的心理症状水平与心理健康状况。
                        </p>
                        <p class="text-gray-700">
                            该量表以多维度视角覆盖心理问题的核心领域，具有内容全面、操作简便、信效度高的特点，广泛应用于精神卫生机构、心理咨询服务、高校心理健康普查、企业员工心理评估等场景。
                        </p>
                    </div>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">量表结构</h3>
                        <p class="text-gray-700 mb-4">
                            SCL-90共包含90个条目，涵盖10个因子维度（9个症状因子 + 1个附加因子），每个条目均采用5级评分制（1 = 没有、2 = 很轻、3 = 中等、4 = 偏重、5 = 严重）。
                        </p>
                        
                        <h4 class="text-lg font-medium text-primary mb-3 mt-6">9个症状因子</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                            <li><span class="font-medium">躯体化</span>：反映身体不适感，包括心血管、胃肠道、呼吸等系统的主诉不适。</li>
                            <li><span class="font-medium">强迫症状</span>：指那些明知没有必要，但又无法摆脱的无意义的思想、冲动和行为。</li>
                            <li><span class="font-medium">人际关系敏感</span>：主要指某些个人不自在感和自卑感，尤其是在与其他人相比较时更突出。</li>
                            <li><span class="font-medium">抑郁</span>：反映与临床上抑郁症状群相联系的广泛概念。</li>
                            <li><span class="font-medium">焦虑</span>：指在临床上明显与焦虑症状群相联系的精神症状及体验。</li>
                            <li><span class="font-medium">敌对</span>：主要从思维、情感及行为三方面来反映病人的敌对表现。</li>
                            <li><span class="font-medium">恐怖</span>：它与传统的恐怖状态或广场恐怖所反映的内容基本一致。</li>
                            <li><span class="font-medium">偏执</span>：主要是指猜疑和关系妄想等。</li>
                            <li><span class="font-medium">精神病性</span>：其中幻听、思维播散、被洞悉感等反映精神分裂样症状项目。</li>
                        </ul>
                        
                        <h4 class="text-lg font-medium text-primary mb-3 mt-6">附加因子</h4>
                        <p class="text-gray-700">
                            包括7个条目，主要反映睡眠及饮食情况，在有些资料分析中，将之归为因子10"其他"。
                        </p>
                    </div>
                    
                    <div class="bg-light rounded-lg p-6 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">评分标准</h3>
                        <p class="text-gray-700 mb-4">
                            SCL-90的统计指标主要为两项，即总分和因子分：
                        </p>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                            <li><span class="font-medium">总分</span>：90个项目单项分相加之和，能反映其病情严重程度。</li>
                            <li><span class="font-medium">总均分</span>：总分/90，表示从总体情况看，该受检者的自我感觉位于1-5级间的哪一个分值程度上。</li>
                            <li><span class="font-medium">阳性项目数</span>：单项分≥2的项目数，表示受检者在多少项目上呈有"病状"。</li>
                            <li><span class="font-medium">阴性项目数</span>：单项分=1的项目数，表示受检者"无症状"的项目有多少。</li>
                            <li><span class="font-medium">阳性症状均分</span>：(总分-阴性项目数)/阳性项目数，表示受检者在"有症状"项目中的平均得分。</li>
                            <li><span class="font-medium">因子分</span>：某一因子的所有条目得分之和 ÷ 该因子条目数，反映该维度症状的平均严重程度。</li>
                        </ul>
                        
                        <div class="mt-6 p-4 bg-primary bg-opacity-10 rounded-lg border border-primary">
                            <h4 class="text-lg font-medium text-primary mb-2">结果解释参考</h4>
                            <ul class="list-disc pl-6 space-y-1 text-gray-700">
                                <li>总分超过160分，或阳性项目数超过43项，或任一因子分超过2分，可考虑筛选阳性，提示可能存在某种程度的心理问题。</li>
                                <li>因子分：≤1.50分为该维度无明显症状，1.51-2.00分为轻度，2.01-2.50分为中度，＞2.50分为重度，需重点关注。</li>
                            </ul>
                            <p class="mt-3 text-sm text-gray-600 italic">
                                注意：本测试仅作为初步筛查工具，不能替代专业医生的诊断。如得分较高，建议寻求专业心理咨询或医疗帮助。
                            </p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-10">
                        <button id="about-to-test-btn" class="bg-primary hover:bg-accent text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all-300 text-lg">
                            开始测试
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 测试页面 -->
        <section id="test" class="py-16 bg-gray-50 hidden">
            <div class="container mx-auto px-4">
                <div class="max-w-3xl mx-auto">
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-semibold text-gray-700">测试进度</h3>
                                <span id="progress-text" class="text-sm text-gray-600">0/90</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="progress-bar" class="bg-primary h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div id="test-instructions" class="mb-8">
                            <h2 class="text-2xl font-bold text-primary mb-4">测试说明</h2>
                            <p class="text-gray-700 mb-4">
                                以下表格中列出了有些人可能会有的问题，请仔细地阅读每一条，然后根据最近一星期以内下述情况影响你的实际感觉，选择一个最适合你的答案。
                            </p>
                            <div class="bg-light p-4 rounded-lg mb-4">
                                <h4 class="font-medium text-primary mb-2">评分标准：</h4>
                                <ul class="list-disc pl-6 space-y-1 text-gray-700">
                                    <li><span class="font-medium">1. 没有</span>：自觉并无该项问题(症状)</li>
                                    <li><span class="font-medium">2. 很轻</span>：自觉有该问题，但发生得并不频繁、不严重</li>
                                    <li><span class="font-medium">3. 中等</span>：自觉有该项症状，其严重程度为轻到中度</li>
                                    <li><span class="font-medium">4. 偏重</span>：自觉常有该项症状，其程度为中到严重</li>
                                    <li><span class="font-medium">5. 严重</span>：自觉该症状的频度和强度都十分严重</li>
                                </ul>
                            </div>
                            <p class="text-gray-700 mb-4">
                                请务必如实回答，您的回答将严格保密。测试大约需要10-15分钟完成。
                            </p>
                            <div class="text-center">
                                <button id="start-test-instructions-btn" class="bg-primary hover:bg-accent text-white font-bold py-2 px-6 rounded-lg shadow transition-all-300">
                                    开始测试
                                </button>
                            </div>
                        </div>
                        
                        <div id="question-container" class="hidden">
                            <h3 id="question-number" class="text-lg font-semibold text-primary mb-4">问题 1/90</h3>
                            <p id="question-text" class="text-xl text-gray-800 mb-6">问题内容将显示在这里</p>
                            
                            <div id="options-container" class="space-y-3">
                                <!-- 选项将通过JavaScript动态生成 -->
                            </div>
                            
                            <div class="flex justify-between mt-8">
                                <button id="prev-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg shadow transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                    上一题
                                </button>
                                <button id="next-btn" class="bg-primary hover:bg-accent text-white font-bold py-2 px-6 rounded-lg shadow transition-all-300">
                                    下一题
                                </button>
                            </div>
                        </div>
                        
                        <div id="test-complete" class="hidden text-center py-8">
                            <div class="mb-6">
                                <i class="fa fa-check-circle text-6xl text-green-500"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-primary mb-4">测试完成！</h2>
                            <p class="text-gray-700 mb-6">
                                感谢您完成SCL-90症状自评量表测试。我们正在分析您的结果，请稍候。
                            </p>
                            <div class="animate-pulse">
                                <div class="inline-block h-4 w-4 rounded-full bg-primary opacity-75 mr-1"></div>
                                <div class="inline-block h-4 w-4 rounded-full bg-primary opacity-75 mr-1"></div>
                                <div class="inline-block h-4 w-4 rounded-full bg-primary opacity-75"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 结果页面 -->
        <section id="result" class="py-16 bg-white hidden">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-primary mb-2 text-center">SCL-90症状自评量表结果</h2>
                <p class="text-lg text-gray-500 mb-8 text-center">小红书-少女尤迦</p>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">总体评估</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="mb-6 p-4 bg-white rounded-lg shadow-md border-l-4 border-primary">
                                    <h4 class="text-lg font-medium text-gray-700 mb-2">总分：<span id="total-score" class="text-primary font-bold text-4xl">0</span></h4>
                                    <div class="w-full bg-gray-200 rounded-full h-3 mt-3">
                                        <div id="total-score-bar" class="bg-primary h-3 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between text-sm text-gray-600 mt-1">
                                        <span>0</span>
                                        <span class="font-medium text-yellow-600">160</span>
                                        <span class="font-medium text-orange-600">350</span>
                                        <span class="font-medium text-red-600">450</span>
                                    </div>
                                    <p class="text-sm text-gray-500 mt-2">总分超过160分提示可能存在某种程度的心理问题</p>
                                </div>
                                
                                <div class="mb-4">
                                    <h4 class="text-lg font-medium text-gray-700 mb-2">总症状指数：<span id="total-index" class="text-primary font-bold">0</span></h4>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="total-index-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                                        <span>1</span>
                                        <span>2</span>
                                        <span>3</span>
                                        <span>4</span>
                                        <span>5</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="mb-4">
                                    <h4 class="text-lg font-medium text-gray-700 mb-2">阳性项目数：<span id="positive-count" class="text-primary font-bold">0</span>/90</h4>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="positive-count-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h4 class="text-lg font-medium text-gray-700 mb-2">阳性症状均分：<span id="positive-mean" class="text-primary font-bold">0</span></h4>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div id="positive-mean-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                                        <span>1</span>
                                        <span>2</span>
                                        <span>3</span>
                                        <span>4</span>
                                        <span>5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-white rounded-lg border border-gray-200">
                            <h4 class="text-lg font-medium text-primary mb-2">总体评估结果</h4>
                            <p id="overall-assessment" class="text-gray-700">
                                评估结果将显示在这里...
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">因子分分析</h3>
                        
                        <div class="chart-container mb-6">
                            <canvas id="radar-chart"></canvas>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div id="factor-details-1" class="space-y-4">
                                <!-- 因子详情将通过JavaScript动态生成 -->
                            </div>
                            <div id="factor-details-2" class="space-y-4">
                                <!-- 因子详情将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <h3 class="text-xl font-semibold text-primary mb-4">AI辅助解读</h3>
                        <div id="ai-insights" class="p-4 bg-white rounded-lg border border-gray-200">
                            <div class="flex items-start mb-4">
                                <div class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fa fa-robot"></i>
                                </div>
                                <p class="text-gray-700">
                                    根据您的测试结果，我为您提供以下解读和建议：
                                </p>
                            </div>
                            <div id="ai-interpretation" class="text-gray-700 mb-4">
                                AI解读内容将显示在这里...
                            </div>
                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <h4 class="font-medium text-primary mb-2">建议与资源</h4>
                                <ul id="ai-recommendations" class="list-disc pl-6 space-y-1 text-gray-700">
                                    <!-- AI建议将通过JavaScript动态生成 -->
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 rounded-lg p-6 mb-8 border border-yellow-200">
                        <h3 class="text-xl font-semibold text-yellow-700 mb-4 flex items-center">
                            <i class="fa fa-exclamation-circle mr-2"></i>
                            重要提示
                        </h3>
                        <p class="text-gray-700 mb-4">
                            本测试结果仅供参考，不能替代专业医生或心理师的诊断。如果您的测试结果显示较严重的心理困扰，建议您：
                        </p>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700">
                            <li>寻求专业心理咨询师或心理医生的帮助</li>
                            <li>与您的家庭医生讨论您的症状</li>
                            <li>如果您有自杀念头或其他紧急情况，请立即前往最近的医院就诊</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-6 mb-8 border border-blue-200 relative">
                        <h3 class="text-xl font-semibold text-blue-700 mb-4 flex items-center">
                            <i class="fa fa-lightbulb-o mr-2"></i>
                            测试结果辅助建议
                        </h3>
                        <p class="text-gray-700 mb-4">
                            根据您的测试结果，以下是一些针对性的建议，帮助您更好地理解和改善心理健康状况：
                        </p>
                        <div id="adaptive-suggestions" class="space-y-4">
                            <div class="p-4 bg-white rounded-lg shadow-sm">
                                <h4 class="font-medium text-primary mb-2">理解您的测试结果</h4>
                                <p class="text-gray-600">
                                    SCL-90测试结果反映的是您当前的心理状态，而不是固定的"标签"。分数波动是正常的，重要的是关注趋势变化和自己的主观感受。
                                </p>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm">
                                <h4 class="font-medium text-primary mb-2">日常心理健康维护</h4>
                                <ul class="list-disc pl-6 space-y-1 text-gray-600">
                                    <li>保持规律的作息时间，确保充足睡眠（7-9小时）</li>
                                    <li>每天进行至少30分钟的身体活动，如散步、瑜伽或游泳</li>
                                    <li>培养正念意识，每天花几分钟时间进行深呼吸或冥想</li>
                                    <li>建立健康的社交支持网络，与亲友保持联系</li>
                                    <li>学习情绪管理技巧，如情绪日记、认知重构等</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm">
                                <h4 class="font-medium text-primary mb-2">何时寻求专业帮助</h4>
                                <p class="text-gray-600">
                                    如果您持续感受到以下情况，建议寻求专业心理健康服务：
                                </p>
                                <ul class="list-disc pl-6 space-y-1 text-gray-600">
                                    <li>症状严重影响日常生活、工作或学习</li>
                                    <li>负面情绪持续存在，无法自行缓解</li>
                                    <li>出现睡眠、食欲或体重的明显变化</li>
                                    <li>感到无助、绝望或有自杀念头</li>
                                    <li>亲友关心您的心理健康状况</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm">
                                <h4 class="font-medium text-primary mb-2">自助资源推荐</h4>
                                <ul class="list-disc pl-6 space-y-1 text-gray-600">
                                    <li>心理健康书籍和自助读物</li>
                                    <li>冥想和放松练习的手机应用</li>
                                    <li>线上心理健康知识平台和社区</li>
                                    <li>心理健康科普视频和播客</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 水印 -->
                    <div class="absolute bottom-4 right-4 opacity-20 pointer-events-none">
                        <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a7ce86d94f4640e99a0fc2ae5f23f186~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601221509312453338D6835F105D626&rrcfp=f06b921b&x-expires=1771657792&x-signature=hwyjzlXdszti4bb3COn7z1ivRUM%3D" alt="小红书-少女尤迦" class="h-24 w-24 rounded-full">
                    </div>
                    
                    <div class="flex flex-col md:flex-row justify-between items-center mt-10">
                        <button id="save-result-btn" class="bg-primary hover:bg-accent text-white font-bold py-3 px-6 rounded-lg shadow transition-all-300 mb-4 md:mb-0">
                            <i class="fa fa-download mr-2"></i>
                            保存结果
                        </button>
                        <button id="restart-test-btn" class="bg-white hover:bg-light text-primary font-bold py-3 px-6 rounded-lg shadow transition-all-300 border border-primary">
                            <i class="fa fa-refresh mr-2"></i>
                            重新测试
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 登录页面 -->
        <section id="login" class="min-h-screen bg-wave">
            <div class="overlay min-h-screen flex items-center">
                <div class="container mx-auto px-4 py-16">
                    <div class="max-w-md mx-auto bg-white rounded-lg shadow-xl p-8 slide-in">
                        <div class="text-center mb-8">
                            <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8e0588acf21c4fd6ae368b01ef4f018f~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=20260122120540A0A3845125721304BA05&rrcfp=f06b921b&x-expires=1771646782&x-signature=v19Yaxu%2FPUgWbIM0438P%2F5Pk%2BMs%3D" alt="Logo" class="h-16 w-16 mx-auto mb-4">
                            <h2 class="text-2xl font-bold text-primary">心理健康评估</h2>
                            <p class="text-gray-600">请输入兑换码以继续</p>
                        </div>
                        
                        <div class="mb-6">
                            <label for="redeem-code" class="block text-gray-700 font-medium mb-2">兑换码</label>
                            <input type="text" id="redeem-code" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="请输入8位兑换码">
                            <p id="login-error" class="text-red-500 text-sm mt-2 hidden"></p>
                        </div>
                        
                        <button id="login-btn" class="w-full bg-primary hover:bg-accent text-white font-bold py-3 px-6 rounded-lg shadow transition-all-300">
                            登录
                        </button>
                        
                        <div class="mt-6 text-center">
                            <p class="text-gray-600 text-sm mb-4">
                                兑换码有效期为24小时，每个兑换码仅限一台设备使用
                            </p>
                            <div class="flex justify-center items-center space-x-6 mt-4">
                                <a href="https://xhslink.com/m/3h0zyAPnMtu" target="_blank" class="flex items-center text-primary hover:text-accent transition-all-300">
                                    <i class="fa fa-shopping-bag text-xl mr-2"></i>
                                    <span>小红书店铺</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 管理员页面 -->
        <section id="admin" class="py-16 bg-white hidden">
            <div class="container mx-auto px-4">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-primary mb-8 text-center">兑换码管理</h2>
                    
                    <div class="bg-light rounded-lg p-6 mb-8 shadow-md">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-primary">兑换码列表</h3>
                            <div class="flex space-x-2">
                                <button id="generate-code-btn" class="bg-primary hover:bg-accent text-white font-bold py-2 px-4 rounded-lg shadow transition-all-300">
                                    <i class="fa fa-plus mr-2"></i> 生成新兑换码
                                </button>
                                <button id="generate-batch-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-all-300">
                                    <i class="fa fa-bolt mr-2"></i> 批量生成
                                </button>
                            </div>
                        </div>
                        
                        <!-- 批量生成配置 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="batch-count" class="block text-sm font-medium text-gray-700 mb-1">生成数量</label>
                                <input type="number" id="batch-count" min="1" max="1000" value="10" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label for="expiry-days" class="block text-sm font-medium text-gray-700 mb-1">使用后有效期（天）</label>
                                <input type="number" id="expiry-days" min="1" max="365" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label for="code-prefix" class="block text-sm font-medium text-gray-700 mb-1">前缀</label>
                                <input type="text" id="code-prefix" value="SCL" maxlength="10" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary uppercase">
                            </div>
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div class="flex flex-wrap gap-2">
                            <button id="export-csv-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-all-300">
                                <i class="fa fa-download mr-2"></i> 导出CSV
                            </button>
                            <button id="clear-codes-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-all-300">
                                <i class="fa fa-trash mr-2"></i> 清空所有
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">兑换码</th>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">创建时间</th>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">过期时间</th>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">状态</th>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">绑定设备</th>
                                        <th class="py-3 px-4 border-b border-gray-200 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="codes-table-body">
                                    <!-- 兑换码列表将通过JavaScript动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="max-w-6xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <h3 class="text-xl font-bold mb-4">心理健康评估</h3>
                        <p class="text-gray-400">
                            提供专业的心理健康自评工具，帮助您了解自己的心理状态，及时寻求帮助。
                        </p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">快速链接</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-home">首页</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-about">关于量表</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-test">开始测试</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-result">查看结果</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-login">登录</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition-all-300" id="footer-admin">管理员</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">关于我们</h3>
                        <p class="text-gray-400">
                            提供专业的心理健康自评工具，帮助您了解自己的心理状态，及时寻求帮助。
                        </p>
                    </div>
                </div>
                <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                    <p>&copy; 2026 心理健康评估. 保留所有权利.</p>
                    <p class="mt-2 text-sm">
                        免责声明：本网站提供的测试仅供参考，不能替代专业医疗建议。
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ========== 兑换码系统功能 ==========

        // 生成8位随机兑换码
        function generateRedeemCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除容易混淆的字符
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // 生成带前缀的兑换码
        function generatePrefixedRedeemCode(prefix = 'SCL') {
            return prefix + '-' + generateRedeemCode();
        }

        // 获取设备唯一标识
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            
            return deviceId;
        }

        // 获取设备信息
        function getDeviceInfo() {
            return {
                deviceId: getDeviceId(),
                userAgent: navigator.userAgent,
                screen: `${window.screen.width}x${window.screen.height}`,
                language: navigator.language,
                platform: navigator.platform
            };
        }

        // 验证兑换码
        function validateRedeemCode(code) {
            try {
                const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
                const redeemCode = redeemCodes.find(rc => rc.code === code);
                
                if (!redeemCode) {
                    return { valid: false, message: '兑换码不存在' };
                }
                
                if (redeemCode.status !== 'active' && redeemCode.status !== 'used') {
                    return { valid: false, message: '兑换码已失效' };
                }
                
                const now = Date.now();
                if (now > redeemCode.expiresAt) {
                    redeemCode.status = 'expired';
                    localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                    return { valid: false, message: '兑换码已过期' };
                }
                
                const deviceId = getDeviceId();
                
                if (redeemCode.status === 'used') {
                    if (redeemCode.deviceInfo.deviceId !== deviceId) {
                        return { valid: false, message: '兑换码已被其他设备使用' };
                    }
                } else {
                    redeemCode.status = 'used';
                    redeemCode.deviceInfo = getDeviceInfo();
                    redeemCode.usedAt = now;
                    // 使用后才开始计算有效期
                    const expiryDays = redeemCode.expiryDays || 1; // 默认1天
                    redeemCode.expiresAt = now + (expiryDays * 24 * 60 * 60 * 1000);
                    localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                }
                
                redeemCode.lastAccessed = now;
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                
                localStorage.setItem('currentRedeemCode', JSON.stringify({
                    code: redeemCode.code,
                    expiresAt: redeemCode.expiresAt,
                    deviceId: deviceId
                }));
                
                return { 
                    valid: true, 
                    message: '兑换码验证成功',
                    expiresAt: redeemCode.expiresAt,
                    remainingTime: redeemCode.expiresAt - now
                };
                
            } catch (error) {
                console.error('验证兑换码时出错:', error);
                return { valid: false, message: '验证兑换码时发生错误' };
            }
        }

        // 检查用户是否有权限访问功能
        function checkAccessPermission() {
            try {
                const currentCode = localStorage.getItem('currentRedeemCode');
                
                if (!currentCode) {
                    return { hasPermission: false, reason: '未登录' };
                }
                
                const codeData = JSON.parse(currentCode);
                const now = Date.now();
                
                if (now > codeData.expiresAt) {
                    return { hasPermission: false, reason: '兑换码已过期' };
                }
                
                const deviceId = getDeviceId();
                if (codeData.deviceId !== deviceId) {
                    return { hasPermission: false, reason: '设备不匹配' };
                }
                
                return { hasPermission: true };
                
            } catch (error) {
                console.error('检查权限时出错:', error);
                return { hasPermission: false, reason: '验证失败' };
            }
        }

        // 保护页面访问
        function protectPageAccess() {
            const permission = checkAccessPermission();
            
            if (!permission.hasPermission) {
                showSection('login');
                return false;
            }
            
            return true;
        }

        // 创建新的兑换码
        function createNewRedeemCode() {
            const code = generatePrefixedRedeemCode();
            const now = Date.now();
            const expiresAt = now + (10 * 365 * 24 * 60 * 60 * 1000); // 未使用时有效期10年（相当于永久）
            
            const newCode = {
                code: code,
                createdAt: now,
                expiresAt: expiresAt,
                status: 'active',
                deviceInfo: null,
                usedAt: null,
                lastAccessed: null
            };
            
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            redeemCodes.push(newCode);
            localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            
            return newCode;
        }

        // 获取所有兑换码
        function getAllRedeemCodes() {
            return JSON.parse(localStorage.getItem('redeemCodes') || '[]');
        }

        // 更新兑换码状态
        function updateRedeemCodeStatus(code, status) {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const codeIndex = redeemCodes.findIndex(rc => rc.code === code);
            
            if (codeIndex !== -1) {
                redeemCodes[codeIndex].status = status;
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
                return true;
            }
            
            return false;
        }

        // 删除兑换码
        function deleteRedeemCode(code) {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const filteredCodes = redeemCodes.filter(rc => rc.code !== code);
            
            localStorage.setItem('redeemCodes', JSON.stringify(filteredCodes));
            return true;
        }

        // 清理过期的兑换码
        function cleanupExpiredCodes() {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const now = Date.now();
            let updated = false;
            
            redeemCodes.forEach(code => {
                if (code.status === 'active' && now > code.expiresAt) {
                    code.status = 'expired';
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            }
        }

        // 初始化管理员账户
        function initializeAdminAccount() {
            const adminAccount = localStorage.getItem('adminAccount');
            
            if (!adminAccount) {
                const defaultAdmin = {
                    username: 'admin',
                    password: 'admin123',
                    createdAt: Date.now()
                };
                
                localStorage.setItem('adminAccount', JSON.stringify(defaultAdmin));
            }
        }

        // 管理员登录验证
        function authenticateAdmin(username, password) {
            const adminAccount = JSON.parse(localStorage.getItem('adminAccount') || '{}');
            
            return adminAccount.username === username && adminAccount.password === password;
        }

        // 格式化时间戳
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // 获取状态显示文本和样式
        function getStatusDisplay(status) {
            switch (status) {
                case 'active':
                    return { text: '未使用', class: 'bg-green-100 text-green-800' };
                case 'used':
                    return { text: '已使用', class: 'bg-blue-100 text-blue-800' };
                case 'expired':
                    return { text: '已过期', class: 'bg-gray-100 text-gray-800' };
                case 'invalid':
                    return { text: '已禁用', class: 'bg-red-100 text-red-800' };
                default:
                    return { text: '未知', class: 'bg-yellow-100 text-yellow-800' };
            }
        }

        // 渲染兑换码列表
        function renderRedeemCodes() {
            const codes = getAllRedeemCodes();
            const tableBody = document.getElementById('codes-table-body');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            codes.forEach(code => {
                const status = getStatusDisplay(code.status);
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td class="py-4 px-4 border-b border-gray-200">${code.code}</td>
                    <td class="py-4 px-4 border-b border-gray-200">${formatTimestamp(code.createdAt)}</td>
                    <td class="py-4 px-4 border-b border-gray-200">${formatTimestamp(code.expiresAt)}</td>
                    <td class="py-4 px-4 border-b border-gray-200">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${status.class}">${status.text}</span>
                    </td>
                    <td class="py-4 px-4 border-b border-gray-200">${code.deviceInfo ? code.deviceInfo.deviceId.substring(0, 10) + '...' : '-'}</td>
                    <td class="py-4 px-4 border-b border-gray-200">
                        <div class="flex space-x-2">
                            ${code.status === 'active' ? `
                                <button class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors" 
                                        onclick="updateRedeemCodeStatus('${code.code}', 'invalid'); renderRedeemCodes();">
                                    禁用
                                </button>
                            ` : ''}
                            ${code.status === 'invalid' ? `
                                <button class="px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600 transition-colors" 
                                        onclick="updateRedeemCodeStatus('${code.code}', 'active'); renderRedeemCodes();">
                                    启用
                                </button>
                            ` : ''}
                            <button class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors" 
                                    onclick="if(confirm('确定要删除这个兑换码吗？')) { deleteRedeemCode('${code.code}'); renderRedeemCodes(); }">
                                删除
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // 显示登录错误信息
        function showLoginError(message) {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }
        }

        // 隐藏登录错误信息
        function hideLoginError() {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.classList.add('hidden');
            }
        }

        // 初始化兑换码系统事件监听
        function initializeRedeemCodeEventListeners() {
            // 登录按钮
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                    const redeemCodeInput = document.getElementById('redeem-code');
                    const code = redeemCodeInput ? redeemCodeInput.value.trim().toUpperCase() : '';
                    
                    if (!code) {
                        showLoginError('请输入兑换码');
                        return;
                    }
                    
                    hideLoginError();
                    
                    const result = validateRedeemCode(code);
                    
                    if (result.valid) {
                        showSection('home');
                        showNotification(`登录成功！兑换码有效期至：${new Date(result.expiresAt).toLocaleString('zh-CN')}`, 'success');
                    } else {
                        showLoginError(result.message);
                    }
                });
            }
            
            // 单个生成兑换码按钮
            const generateCodeBtn = document.getElementById('generate-code-btn');
            if (generateCodeBtn) {
                generateCodeBtn.addEventListener('click', function() {
                    const newCode = createNewRedeemCode();
                    renderRedeemCodes();
                    showNotification(`新兑换码已生成：${newCode.code}`, 'success');
                });
            }
            
            // 批量生成兑换码按钮
            const generateBatchBtn = document.getElementById('generate-batch-btn');
            if (generateBatchBtn) {
                generateBatchBtn.addEventListener('click', function() {
                    const count = parseInt(document.getElementById('batch-count').value) || 10;
                    const expiryDays = parseInt(document.getElementById('expiry-days').value) || 1;
                    const prefix = document.getElementById('code-prefix').value || 'SCL';
                    
                    if (count < 1 || count > 1000) {
                        showNotification('生成数量必须在1-1000之间', 'error');
                        return;
                    }
                    
                    const newCodes = generateBatchCodes(count, expiryDays, prefix);
                    renderRedeemCodes();
                    showNotification(`成功生成 ${count} 个兑换码`, 'success');
                });
            }
            
            // 导出CSV按钮
            const exportCsvBtn = document.getElementById('export-csv-btn');
            if (exportCsvBtn) {
                exportCsvBtn.addEventListener('click', function() {
                    exportToCSV();
                });
            }
            
            // 清空兑换码按钮
            const clearCodesBtn = document.getElementById('clear-codes-btn');
            if (clearCodesBtn) {
                clearCodesBtn.addEventListener('click', function() {
                    if (confirm('确定要清空所有兑换码吗？此操作不可恢复！')) {
                        clearAllCodes();
                        renderRedeemCodes();
                        showNotification('已清空所有兑换码', 'success');
                    }
                });
            }
            
            // 搜索兑换码
            const searchCodesInput = document.getElementById('search-codes');
            if (searchCodesInput) {
                searchCodesInput.addEventListener('input', function() {
                    renderRedeemCodes();
                });
            }
            
            // 兑换码输入框回车事件
            const redeemCodeInput = document.getElementById('redeem-code');
            if (redeemCodeInput) {
                redeemCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const loginBtn = document.getElementById('login-btn');
                        if (loginBtn) {
                            loginBtn.click();
                        }
                    }
                });
            }
        }
        
        // 批量生成兑换码
        function generateBatchCodes(count, expiryDays, prefix) {
            const newCodes = [];
            const now = Date.now();
            const expiryMs = expiryDays * 24 * 60 * 60 * 1000;
            
            for (let i = 0; i < count; i++) {
                const code = generatePrefixedRedeemCode(prefix);
                newCodes.push({
                    code: code,
                    createdAt: now,
                    expiresAt: now + (10 * 365 * 24 * 60 * 60 * 1000), // 未使用时有效期10年（相当于永久）
                    expiryDays: expiryDays, // 记录使用后有效期天数
                    status: 'active',
                    deviceInfo: null,
                    usedAt: null,
                    lastAccessed: null
                });
            }
            
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            redeemCodes.push(...newCodes);
            localStorage.setItem('redeemCodes', JSON.stringify(redeemCodes));
            
            return newCodes;
        }
        
        // 导出为CSV
        function exportToCSV() {
            const redeemCodes = JSON.parse(localStorage.getItem('redeemCodes') || '[]');
            const activeCodes = redeemCodes.filter(code => code.status === 'active');
            
            if (activeCodes.length === 0) {
                showNotification('没有可用的兑换码', 'warning');
                return;
            }
            
            // 创建CSV内容
            let csvContent = "兑换码,创建时间,过期时间\n";
            
            activeCodes.forEach(code => {
                const createdAt = new Date(code.createdAt).toLocaleString('zh-CN');
                const expiresAt = new Date(code.expiresAt).toLocaleString('zh-CN');
                csvContent += `"${code.code}","${createdAt}","${expiresAt}"\n`;
            });
            
            // 创建Blob对象
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `兑换码_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            // 添加到页面并触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`成功导出 ${activeCodes.length} 个兑换码`, 'success');
        }
        
        // 清空所有兑换码
        function clearAllCodes() {
            localStorage.removeItem('batchRedeemCodes');
        }
        
        // 生成单个兑换码（增强版）
        function createNewRedeemCode() {
            const prefix = document.getElementById('code-prefix') ? document.getElementById('code-prefix').value : 'SCL';
            const expiryDays = document.getElementById('expiry-days') ? parseInt(document.getElementById('expiry-days').value) : 1;
            
            const code = generateRedeemCode(prefix);
            const now = Date.now();
            const expiryMs = expiryDays * 24 * 60 * 60 * 1000;
            
            const newCode = {
                code: code,
                createdAt: now,
                expiresAt: now + expiryMs,
                status: 'active'
            };
            
            const redeemCodes = JSON.parse(localStorage.getItem('batchRedeemCodes') || '[]');
            redeemCodes.unshift(newCode);
            localStorage.setItem('batchRedeemCodes', JSON.stringify(redeemCodes));
            
            return newCode;
        }
        
        // 生成兑换码字符串
        function generateRedeemCode(prefix = 'SCL') {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除容易混淆的字符
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return prefix + '-' + code;
        }
        // SCL-90题目数据
        const questions = [
            { id: 1, text: "头痛", factor: "somatization" },
            { id: 2, text: "神经过敏，心中不踏实", factor: "anxiety" },
            { id: 3, text: "头脑中有不必要的想法或字句盘旋", factor: "obsessive" },
            { id: 4, text: "头昏或晕倒", factor: "somatization" },
            { id: 5, text: "对异性的兴趣减退", factor: "depression" },
            { id: 6, text: "对旁人责备求全", factor: "interpersonal" },
            { id: 7, text: "感到别人能控制您的思想", factor: "psychoticism" },
            { id: 8, text: "责怪别人制造麻烦", factor: "paranoid" },
            { id: 9, text: "忘记性大", factor: "obsessive" },
            { id: 10, text: "担心自己的衣饰整齐及仪态的端正", factor: "obsessive" },
            { id: 11, text: "容易烦恼和激动", factor: "hostility" },
            { id: 12, text: "胸痛", factor: "somatization" },
            { id: 13, text: "害怕空旷的场所或街道", factor: "phobic" },
            { id: 14, text: "感到自己的精力下降，活动减慢", factor: "depression" },
            { id: 15, text: "想结束自己的生命", factor: "depression" },
            { id: 16, text: "听到旁人听不到的声音", factor: "psychoticism" },
            { id: 17, text: "发抖", factor: "anxiety" },
            { id: 18, text: "感到大多数人都不可信任", factor: "paranoid" },
            { id: 19, text: "胃口不好", factor: "additional" },
            { id: 20, text: "容易哭泣", factor: "depression" },
            { id: 21, text: "同异性相处时感到害羞不自在", factor: "interpersonal" },
            { id: 22, text: "感到受骗，中了圈套或有人想抓住您", factor: "depression" },
            { id: 23, text: "无缘无故地突然感到害怕", factor: "anxiety" },
            { id: 24, text: "自己不能控制地大发脾气", factor: "hostility" },
            { id: 25, text: "怕单独出门", factor: "phobic" },
            { id: 26, text: "经常责怪自己", factor: "depression" },
            { id: 27, text: "腰痛", factor: "somatization" },
            { id: 28, text: "感到难以完成任务", factor: "obsessive" },
            { id: 29, text: "感到孤独", factor: "depression" },
            { id: 30, text: "感到苦闷", factor: "depression" },
            { id: 31, text: "过分担忧", factor: "depression" },
            { id: 32, text: "对事物不感兴趣", factor: "depression" },
            { id: 33, text: "感到害怕", factor: "anxiety" },
            { id: 34, text: "您的感情容易受到伤害", factor: "interpersonal" },
            { id: 35, text: "旁人能知道您的私下想法", factor: "psychoticism" },
            { id: 36, text: "感到别人不理解您、不同情您", factor: "interpersonal" },
            { id: 37, text: "感到人们对您不友好，不喜欢您", factor: "interpersonal" },
            { id: 38, text: "做事必须做得很慢以保证做得正确", factor: "obsessive" },
            { id: 39, text: "心跳得很厉害", factor: "anxiety" },
            { id: 40, text: "恶心或胃部不舒服", factor: "somatization" },
            { id: 41, text: "感到比不上他人", factor: "interpersonal" },
            { id: 42, text: "肌肉酸痛", factor: "somatization" },
            { id: 43, text: "感到有人在监视您、谈论您", factor: "paranoid" },
            { id: 44, text: "难以入睡", factor: "additional" },
            { id: 45, text: "做事必须反复检查", factor: "obsessive" },
            { id: 46, text: "难以做出决定", factor: "obsessive" },
            { id: 47, text: "怕乘电车、公共汽车、地铁或火车", factor: "phobic" },
            { id: 48, text: "呼吸有困难", factor: "somatization" },
            { id: 49, text: "一阵阵发冷或发热", factor: "somatization" },
            { id: 50, text: "因为感到害怕而避开某些东西、场合或活动", factor: "phobic" },
            { id: 51, text: "脑子变空了", factor: "obsessive" },
            { id: 52, text: "身体发麻或刺痛", factor: "somatization" },
            { id: 53, text: "喉咙有梗塞感", factor: "somatization" },
            { id: 54, text: "感到对前途没有希望", factor: "depression" },
            { id: 55, text: "不能集中注意力", factor: "obsessive" },
            { id: 56, text: "感到身体的某一部分软弱无力", factor: "somatization" },
            { id: 57, text: "感到紧张或容易紧张", factor: "anxiety" },
            { id: 58, text: "感到手或脚发重", factor: "somatization" },
            { id: 59, text: "想到有关死亡的事", factor: "additional" },
            { id: 60, text: "吃得太多", factor: "additional" },
            { id: 61, text: "当别人看着您或谈论您时感到不自在", factor: "interpersonal" },
            { id: 62, text: "有一些不属于您自己的想法", factor: "psychoticism" },
            { id: 63, text: "有想打人或伤害他人的冲动", factor: "hostility" },
            { id: 64, text: "醒得太早", factor: "additional" },
            { id: 65, text: "必须反复洗手、点数目或触摸某些东西", factor: "obsessive" },
            { id: 66, text: "睡得不稳不深", factor: "additional" },
            { id: 67, text: "有想摔坏或破坏东西的冲动", factor: "hostility" },
            { id: 68, text: "有一些别人没有的想法或念头", factor: "paranoid" },
            { id: 69, text: "感到对别人神经过敏", factor: "interpersonal" },
            { id: 70, text: "在商店或电影院等人多的地方感到不自在", factor: "phobic" },
            { id: 71, text: "感到任何事情都很难做", factor: "depression" },
            { id: 72, text: "一阵阵恐惧或惊恐", factor: "anxiety" },
            { id: 73, text: "感到在公共场合吃东西很不舒服", factor: "interpersonal" },
            { id: 74, text: "经常与人争论", factor: "hostility" },
            { id: 75, text: "单独一人时神经很紧张", factor: "phobic" },
            { id: 76, text: "别人对您的成绩没有作出恰当的评价", factor: "paranoid" },
            { id: 77, text: "即使和别人在一起也感到孤单", factor: "psychoticism" },
            { id: 78, text: "感到坐立不安心神不宁", factor: "anxiety" },
            { id: 79, text: "感到自己没有什么价值", factor: "depression" },
            { id: 80, text: "感到熟悉的东西变成陌生或不象是真的", factor: "anxiety" },
            { id: 81, text: "大叫或摔东西", factor: "hostility" },
            { id: 82, text: "害怕会在公共场合昏倒", factor: "phobic" },
            { id: 83, text: "感到别人想占您的便宜", factor: "paranoid" },
            { id: 84, text: "为一些有关\"性\"的想法而很苦恼", factor: "psychoticism" },
            { id: 85, text: "您认为应该因为自己的过错而受到惩罚", factor: "psychoticism" },
            { id: 86, text: "感到要赶快把事情做完", factor: "anxiety" },
            { id: 87, text: "感到自己的身体有严重问题", factor: "psychoticism" },
            { id: 88, text: "从未感到和其他人很亲近", factor: "psychoticism" },
            { id: 89, text: "感到自己有罪", factor: "additional" },
            { id: 90, text: "感到自己的脑子有毛病", factor: "psychoticism" }
        ];

        // 因子分类
        const factors = {
            somatization: {
                name: "躯体化",
                questions: [1, 4, 12, 27, 40, 42, 48, 49, 52, 53, 56, 58],
                description: "主要反映主观的身体不适感，包括心血管、胃肠道、呼吸等系统的主诉不适，和头痛、背痛、肌肉酸痛，以及焦虑的其他躯体表现。"
            },
            obsessive: {
                name: "强迫症状",
                questions: [3, 9, 10, 28, 38, 45, 46, 51, 55, 65],
                description: "主要指那些明知没有必要，但又无法摆脱的无意义的思想、冲动和行为，还有一些比较一般的认知障碍的行为征象也在这一因子中反映。"
            },
            interpersonal: {
                name: "人际关系敏感",
                questions: [6, 21, 34, 36, 37, 41, 61, 69, 73],
                description: "主要指某些个人不自在与自卑感，特别是与其他人相比较时更加突出。在人际交往中的自卑感，心神不安，明显不自在，以及人际交流中的自我意识，消极的期待亦是这方面症状的典型原因。"
            },
            depression: {
                name: "抑郁",
                questions: [5, 14, 15, 20, 22, 26, 29, 30, 31, 32, 54, 71, 79],
                description: "苦闷的情感与心境为代表性症状，还以生活兴趣的减退，动力缺乏，活力丧失等为特征。还反映失望，悲观以及与抑郁相联系的认知和躯体方面的感受，另外，还包括有关死亡的思想和自杀观念。"
            },
            anxiety: {
                name: "焦虑",
                questions: [2, 17, 23, 33, 39, 57, 72, 78, 80, 86],
                description: "一般指那些烦躁，坐立不安，神经过敏，紧张以及由此产生的躯体征象，如震颤等。测定游离不定的焦虑及惊恐发作是本因子的主要内容，还包括一项解体感受的项目。"
            },
            hostility: {
                name: "敌对",
                questions: [11, 24, 63, 67, 74, 81],
                description: "主要从三方面来反映敌对的表现：思想、感情及行为。其项目包括厌烦的感觉，摔物，争论直到不可控制的脾气暴发等各方面。"
            },
            phobic: {
                name: "恐怖",
                questions: [13, 25, 47, 50, 70, 75, 82],
                description: "恐惧的对象包括出门旅行，空旷场地，人群或公共场所和交通工具。此外，还有反映社交恐怖的一些项目。"
            },
            paranoid: {
                name: "偏执",
                questions: [8, 18, 43, 68, 76, 83],
                description: "偏执是一个十分复杂的概念。本因子只是包括了一些基本的内容，主要指投射性思维，敌对，猜疑，关系观念，妄想，被动体验和夸大等。"
            },
            psychoticism: {
                name: "精神病性",
                questions: [7, 16, 35, 62, 77, 84, 85, 87, 88, 90],
                description: "反映各式各样的急性症状和行为，限定不严的精神病性过程的指征。此外，也可以反映精神病性行为的继发征兆和分裂性生活方式的指征。"
            },
            additional: {
                name: "附加项",
                questions: [19, 44, 59, 60, 64, 66, 89],
                description: "未归入上述因子，主要反映睡眠及饮食情况。"
            }
        };

        // 评分选项
        const options = [
            { value: 1, text: "1. 没有" },
            { value: 2, text: "2. 很轻" },
            { value: 3, text: "3. 中等" },
            { value: 4, text: "4. 偏重" },
            { value: 5, text: "5. 严重" }
        ];

        // 当前问题索引
        let currentQuestionIndex = 0;
        // 用户答案
        let userAnswers = [];
        // 结果数据
        let resultData = null;

        // DOM元素
        const sections = {
            home: document.getElementById('home'),
            about: document.getElementById('about'),
            test: document.getElementById('test'),
            result: document.getElementById('result'),
            login: document.getElementById('login'),
            admin: document.getElementById('admin')
        };

        const navLinks = {
            home: document.querySelectorAll('#nav-home, #mobile-nav-home, #footer-home'),
            about: document.querySelectorAll('#nav-about, #mobile-nav-about, #footer-about'),
            test: document.querySelectorAll('#nav-test, #mobile-nav-test, #footer-test'),
            result: document.querySelectorAll('#nav-result, #mobile-nav-result, #footer-result'),
            login: document.querySelectorAll('#nav-login, #mobile-nav-login, #footer-login'),
            admin: document.querySelectorAll('#nav-admin, #mobile-nav-admin, #footer-admin')
        };

        // 移动端菜单
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        // 测试相关元素
        const testInstructions = document.getElementById('test-instructions');
        const questionContainer = document.getElementById('question-container');
        const testComplete = document.getElementById('test-complete');

        // 为导航链接添加事件监听器
        const navTestLinks = document.querySelectorAll('#nav-test, #mobile-nav-test, #footer-test');
        navTestLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const permission = checkAccessPermission();
                if (permission.hasPermission) {
                    showSection('test');
                } else {
                    showSection('redeem');
                    showToast('请先输入有效的兑换码', 'warning');
                }
            });
        });
        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // 结果相关元素
        const totalScore = document.getElementById('total-score');
        const totalScoreBar = document.getElementById('total-score-bar');
        const totalIndex = document.getElementById('total-index');
        const totalIndexBar = document.getElementById('total-index-bar');
        const positiveCount = document.getElementById('positive-count');
        const positiveCountBar = document.getElementById('positive-count-bar');
        const positiveMean = document.getElementById('positive-mean');
        const positiveMeanBar = document.getElementById('positive-mean-bar');
        const overallAssessment = document.getElementById('overall-assessment');
        const factorDetails1 = document.getElementById('factor-details-1');
        const factorDetails2 = document.getElementById('factor-details-2');
        const aiInterpretation = document.getElementById('ai-interpretation');
        const aiRecommendations = document.getElementById('ai-recommendations');

        // 导航功能
        function showSection(sectionId) {
            // 隐藏所有部分
            Object.values(sections).forEach(section => {
                section.classList.add('hidden');
            });
            
            // 显示选定部分
            sections[sectionId].classList.remove('hidden');
            
            // 关闭移动端菜单
            mobileMenu.classList.add('hidden');
            
            // 滚动到顶部
            window.scrollTo(0, 0);
        }

        // 为导航链接添加事件监听器
        Object.entries(navLinks).forEach(([sectionId, links]) => {
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // 检查权限
                    if ((sectionId === 'test' || sectionId === 'result') && !checkAccessPermission().hasPermission) {
                        showSection('login');
                        alert('请先登录以访问此功能');
                        return;
                    }
                    
                    // 特殊处理登录和管理员页面
                    if (sectionId === 'login') {
                        showSection('login');
                    } else if (sectionId === 'admin') {
                        // 简单的管理员验证（实际应用中应该有更安全的验证）
                        const username = prompt('请输入管理员用户名:');
                        const password = prompt('请输入管理员密码:');
                        
                        if (authenticateAdmin(username, password)) {
                            showSection('admin');
                            renderRedeemCodes();
                        } else {
                            alert('管理员验证失败');
                            showSection('home');
                        }
                    } else {
                        showSection(sectionId);
                    }
                });
            });
        });

        // 移动端菜单切换
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // 首页按钮
        document.getElementById('start-test-btn').addEventListener('click', () => {
            const permission = checkAccessPermission();
            if (permission.hasPermission) {
                showSection('test');
            } else {
                showSection('redeem');
                showToast('请先输入有效的兑换码', 'warning');
            }
        });

        document.getElementById('learn-more-btn').addEventListener('click', () => {
            showSection('about');
        });

        // 关于页面按钮
        document.getElementById('about-to-test-btn').addEventListener('click', () => {
            const permission = checkAccessPermission();
            if (permission.hasPermission) {
                showSection('test');
            } else {
                showSection('redeem');
                showToast('请先输入有效的兑换码', 'warning');
            }
        });

        // 测试说明按钮
        document.getElementById('start-test-instructions-btn').addEventListener('click', () => {
            testInstructions.classList.add('hidden');
            questionContainer.classList.remove('hidden');
            showQuestion(currentQuestionIndex);
            updateProgress();
        });

        // 显示当前问题
        function showQuestion(index) {
            const question = questions[index];
            questionNumber.textContent = `问题 ${question.id}/90`;
            questionText.textContent = question.text;
            
            // 清空选项容器
            optionsContainer.innerHTML = '';
            
            // 添加选项
            options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-hover transition-all-300';
                
                const isSelected = userAnswers[index] === option.value;
                
                optionDiv.innerHTML = `
                    <label class="flex items-center p-4 w-full bg-white rounded-lg border ${isSelected ? 'border-primary bg-blue-50' : 'border-gray-200'} hover:border-primary cursor-pointer">
                        <input type="radio" name="question${question.id}" value="${option.value}" class="hidden" ${isSelected ? 'checked' : ''}>
                        <span class="text-gray-700">${option.text}</span>
                    </label>
                `;
                
                optionsContainer.appendChild(optionDiv);
                
                // 添加点击事件
                optionDiv.addEventListener('click', () => {
                    // 移除其他选项的选中状态
                    document.querySelectorAll(`input[name="question${question.id}"]`).forEach(input => {
                        const parentLabel = input.closest('label');
                        parentLabel.classList.remove('border-primary', 'bg-blue-50');
                        parentLabel.classList.add('border-gray-200');
                    });
                    
                    // 设置当前选项为选中状态
                    const radio = optionDiv.querySelector('input');
                    radio.checked = true;
                    const parentLabel = radio.closest('label');
                    parentLabel.classList.remove('border-gray-200');
                    parentLabel.classList.add('border-primary', 'bg-blue-50');
                    
                    // 保存答案
                    userAnswers[currentQuestionIndex] = option.value;
                });
            });
            
            // 更新按钮状态
            prevBtn.disabled = index === 0;
            nextBtn.textContent = index === questions.length - 1 ? '完成测试' : '下一题';
        }

        // 更新进度条
        function updateProgress() {
            const answeredCount = userAnswers.filter(answer => answer !== undefined).length;
            const progressPercentage = (answeredCount / questions.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `${answeredCount}/90`;
        }

        // 上一题按钮
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        // 下一题按钮
        nextBtn.addEventListener('click', () => {
            // 如果当前问题未回答，提示用户
            if (userAnswers[currentQuestionIndex] === undefined) {
                alert('请选择一个选项');
                return;
            }
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
                updateProgress();
            } else {
                // 完成测试
                completeTest();
            }
        });

        // 完成测试
        function completeTest() {
            questionContainer.classList.add('hidden');
            testComplete.classList.remove('hidden');
            
            // 计算结果
            calculateResults();
            
            // 延迟显示结果页面
            setTimeout(() => {
                showSection('result');
                displayResults();
            }, 2000);
        }

        // 计算测试结果
        function calculateResults() {
            // 总分
            const total = userAnswers.reduce((sum, answer) => sum + answer, 0);
            
            // 总症状指数
            const totalIndexScore = total / questions.length;
            
            // 阳性项目数
            const positiveItems = userAnswers.filter(answer => answer > 1).length;
            
            // 阳性症状均分
            const positiveMeanScore = positiveItems > 0 ? (total - userAnswers.filter(answer => answer === 1).length) / positiveItems : 0;
            
            // 因子分
            const factorScores = {};
            Object.entries(factors).forEach(([key, factor]) => {
                const factorQuestions = factor.questions;
                const factorAnswers = factorQuestions.map(qId => {
                    const index = questions.findIndex(q => q.id === qId);
                    return userAnswers[index] || 0;
                });
                const factorTotal = factorAnswers.reduce((sum, answer) => sum + answer, 0);
                factorScores[key] = factorTotal / factorQuestions.length;
            });
            
            // 保存结果
            resultData = {
                total,
                totalIndex: totalIndexScore,
                positiveCount: positiveItems,
                positiveMean: positiveMeanScore,
                factorScores,
                answers: userAnswers
            };
            
            // 保存到本地存储
            localStorage.setItem('scl90Results', JSON.stringify(resultData));
        }

        // 显示测试结果
        function displayResults() {
            if (!resultData) {
                // 尝试从本地存储加载结果
                const savedResults = localStorage.getItem('scl90Results');
                if (savedResults) {
                    resultData = JSON.parse(savedResults);
                } else {
                    alert('没有找到测试结果，请先完成测试');
                    showSection('home');
                    return;
                }
            }
            
            // 显示总体评估
            totalScore.textContent = resultData.total;
            totalScoreBar.style.width = `${Math.min((resultData.total / 450) * 100, 100)}%`;
            
            totalIndex.textContent = resultData.totalIndex.toFixed(2);
            totalIndexBar.style.width = `${Math.min((resultData.totalIndex / 5) * 100, 100)}%`;
            
            positiveCount.textContent = resultData.positiveCount;
            positiveCountBar.style.width = `${Math.min((resultData.positiveCount / 90) * 100, 100)}%`;
            
            positiveMean.textContent = resultData.positiveMean.toFixed(2);
            positiveMeanBar.style.width = `${Math.min((resultData.positiveMean / 5) * 100, 100)}%`;
            
            // 总体评估结果
            let assessmentText = '';
            if (resultData.total <= 160 && resultData.positiveCount <= 43 && Object.values(resultData.factorScores).every(score => score <= 2)) {
                assessmentText = '您的心理健康状况良好，没有明显的心理症状。建议继续保持积极健康的生活方式，定期进行自我评估。';
            } else if (resultData.total > 160 || resultData.positiveCount > 43 || Object.values(resultData.factorScores).some(score => score > 2)) {
                assessmentText = '您的测试结果显示可能存在一定程度的心理症状。建议您关注自己的心理健康状况，适当调整生活方式，必要时寻求专业心理咨询师的帮助。';
                if (Object.values(resultData.factorScores).some(score => score > 3)) {
                    assessmentText += ' 部分因子得分较高，建议尽快寻求专业心理健康服务。';
                }
            }
            
            overallAssessment.textContent = assessmentText;
            
            // 显示因子分雷达图
            displayRadarChart();
            
            // 显示因子详情
            displayFactorDetails();
            
            // 显示AI解读
            displayAIInterpretation();
        }

        // 显示因子分雷达图
        function displayRadarChart() {
            const ctx = document.getElementById('radar-chart').getContext('2d');
            
            // 准备数据
            const labels = Object.entries(factors)
                .filter(([key]) => key !== 'additional')
                .map(([_, factor]) => factor.name);
            
            const data = Object.entries(resultData.factorScores)
                .filter(([key]) => key !== 'additional')
                .map(([_, score]) => score);
            
            // 创建雷达图
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '因子分',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // 显示因子详情
        function displayFactorDetails() {
            factorDetails1.innerHTML = '';
            factorDetails2.innerHTML = '';
            
            const factorEntries = Object.entries(factors).filter(([key]) => key !== 'additional');
            const halfPoint = Math.ceil(factorEntries.length / 2);
            
            factorEntries.forEach(([key, factor], index) => {
                const score = resultData.factorScores[key];
                let severity = '';
                let color = '';
                
                if (score <= 1.5) {
                    severity = '无明显症状';
                    color = 'text-green-600';
                } else if (score <= 2.0) {
                    severity = '轻度';
                    color = 'text-yellow-600';
                } else if (score <= 2.5) {
                    severity = '中度';
                    color = 'text-orange-600';
                } else {
                    severity = '重度';
                    color = 'text-red-600';
                }
                
                const factorDiv = document.createElement('div');
                factorDiv.className = 'bg-white p-4 rounded-lg shadow';
                factorDiv.innerHTML = `
                    <h4 class="text-lg font-medium text-primary mb-2">${factor.name}</h4>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">得分：</span>
                        <span class="text-xl font-bold ${color}">${score.toFixed(2)}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-3">
                        <div class="bg-primary h-2.5 rounded-full" style="width: ${Math.min((score / 5) * 100, 100)}%"></div>
                    </div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-gray-700">严重程度：</span>
                        <span class="font-medium ${color}">${severity}</span>
                    </div>
                    <p class="text-gray-600 text-sm">${factor.description}</p>
                `;
                
                if (index < halfPoint) {
                    factorDetails1.appendChild(factorDiv);
                } else {
                    factorDetails2.appendChild(factorDiv);
                }
            });
        }

        // 显示AI解读
        function displayAIInterpretation() {
            // 找出得分最高的因子
            let highestFactor = null;
            let highestScore = 0;
            
            Object.entries(resultData.factorScores).forEach(([key, score]) => {
                if (key !== 'additional' && score > highestScore) {
                    highestScore = score;
                    highestFactor = factors[key];
                }
            });
            
            // 生成解读文本
            let interpretation = '';
            
            if (resultData.total <= 160 && resultData.positiveCount <= 43 && Object.values(resultData.factorScores).every(score => score <= 2)) {
                interpretation = `
                    您的SCL-90测试结果总体良好，各项因子得分均在正常范围内。这表明您目前的心理状态较为稳定，没有明显的心理困扰。建议您继续保持现有的生活方式和心理状态，定期进行自我评估，关注自己的情绪变化。
                `;
            } else {
                interpretation = `
                    根据您的测试结果，您在某些心理维度上表现出一定程度的症状。其中，${highestFactor.name}因子得分最高（${highestScore.toFixed(2)}），这可能表明您在这方面存在较为明显的困扰。
                    ${highestFactor.description}
                `;
                
                // 根据不同因子提供具体解读
                if (highestFactor.name === '躯体化') {
                    interpretation += `
                        <br><br>您可能经常体验到身体上的不适感，如头痛、肌肉酸痛等，但这些症状可能没有明显的生理原因。这可能是心理压力或情绪问题在身体上的表现。建议您关注自己的情绪状态，学习放松技巧，如深呼吸、渐进性肌肉放松等。
                    `;
                } else if (highestFactor.name === '强迫症状') {
                    interpretation += `
                        <br><br>您可能经常出现一些不必要的想法或行为，明知没有必要但难以控制。这些强迫症状可能会影响您的日常生活和工作。建议您学习接纳这些想法，而不是试图压抑它们，同时可以尝试正念练习来帮助您更好地应对。
                    `;
                } else if (highestFactor.name === '人际关系敏感') {
                    interpretation += `
                        <br><br>您在人际交往中可能经常感到不自在或自卑，过度在意他人的评价。这可能导致您避免社交场合或在人际关系中感到压力。建议您尝试增强自我接纳，认识到每个人都有自己的价值和优点，同时可以通过小步骤逐渐增加社交活动。
                    `;
                } else if (highestFactor.name === '抑郁') {
                    interpretation += `
                        <br><br>您可能经常感到情绪低落、兴趣减退或对未来感到悲观。这些抑郁症状需要认真对待。建议您保持规律的生活作息，适当增加户外活动和社交互动，如症状持续或加重，应寻求专业心理咨询或治疗。
                    `;
                } else if (highestFactor.name === '焦虑') {
                    interpretation += `
                        <br><br>您可能经常感到紧张、不安或担忧，甚至出现心悸、出汗等躯体症状。这些焦虑情绪可能会影响您的日常生活。建议您学习识别焦虑触发因素，练习放松技巧，如深呼吸、冥想等，必要时寻求专业帮助。
                    `;
                } else if (highestFactor.name === '敌对') {
                    interpretation += `
                        <br><br>您可能经常体验到愤怒、烦躁或敌对情绪，甚至有攻击性行为的冲动。这可能会影响您的人际关系和生活质量。建议您学习识别情绪触发因素，寻找健康的情绪表达方式，如运动、写作或与信任的人交流。
                    `;
                } else if (highestFactor.name === '恐怖') {
                    interpretation += `
                        <br><br>您可能对特定的场所、物体或情境存在强烈的恐惧，甚至会避免这些情境。这种恐怖症状可能会限制您的活动范围。建议您考虑使用系统脱敏法，逐渐面对恐惧对象，同时可以寻求专业心理咨询的帮助。
                    `;
                } else if (highestFactor.name === '偏执') {
                    interpretation += `
                        <br><br>您可能经常感到猜疑、不信任他人或认为别人在议论您。这些偏执观念可能会影响您的人际关系和社会功能。建议您尝试从不同角度看待问题，挑战不合理的想法，同时保持开放的心态与他人交流。
                    `;
                } else if (highestFactor.name === '精神病性') {
                    interpretation += `
                        <br><br>您可能偶尔出现一些异常的感知或思维体验。虽然这些症状在一般人群中也可能出现，但如果频繁发生或严重影响生活，应尽快寻求专业精神科医生的评估和帮助。
                    `;
                }
            }
            
            aiInterpretation.innerHTML = interpretation;
            
            // 生成建议
            aiRecommendations.innerHTML = '';
            
            const recommendations = [
                '保持规律的作息时间，确保充足的睡眠',
                '适当进行体育锻炼，如散步、瑜伽或游泳',
                '学习并实践放松技巧，如深呼吸、冥想或渐进性肌肉放松',
                '保持健康的饮食，减少咖啡因和酒精的摄入',
                '与亲友保持联系，分享您的感受和经历',
                '培养兴趣爱好，丰富生活内容',
                '设定合理的目标和期望，避免过度压力',
                '学习情绪管理技巧，如认知重构、情绪日记等'
            ];
            
            // 根据得分高低添加不同的建议
            if (resultData.total > 200 || Object.values(resultData.factorScores).some(score => score > 2.5)) {
                recommendations.push('考虑寻求专业心理咨询师或心理医生的帮助');
                recommendations.push('如症状严重影响日常生活，请尽快就医');
            }
            
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                aiRecommendations.appendChild(li);
            });
        }

        // 保存结果按钮
        document.getElementById('save-result-btn').addEventListener('click', () => {
            alert('结果已保存到本地存储。您可以在"查看结果"页面随时查看您的测试结果。');
        });

        // 重新测试按钮
        document.getElementById('restart-test-btn').addEventListener('click', () => {
            // 重置测试状态
            currentQuestionIndex = 0;
            userAnswers = [];
            resultData = null;
            
            // 显示测试页面
            showSection('test');
            
            // 显示测试说明
            testInstructions.classList.remove('hidden');
            questionContainer.classList.add('hidden');
            testComplete.classList.add('hidden');
            
            // 重置进度条
            progressBar.style.width = '0%';
            progressText.textContent = '0/90';
        });


        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化管理员账户
            initializeAdminAccount();
            // 清理过期兑换码
            cleanupExpiredCodes();
            // 定期检查过期兑换码
            setInterval(cleanupExpiredCodes, 60000); // 每分钟检查一次
            
            // 检查用户权限
            const permission = checkAccessPermission();
            if (!permission.hasPermission && window.location.hash !== '#admin') {
                showSection('login');
            } else {
                showSection('home');
            }
            
            // 尝试从本地存储加载结果
            const savedResults = localStorage.getItem('scl90Results');
            if (savedResults) {
                resultData = JSON.parse(savedResults);
            }
            
            // 初始化兑换码系统事件监听
            initializeRedeemCodeEventListeners();
        });
    </script>
</body>
</html>